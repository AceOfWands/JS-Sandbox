'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Sandbox=function(){function Sandbox(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,Sandbox),this.globalContext=b||{},this.dom=a||document,this.superDetectRegex=/super\.([^(]+)(\(?)/gm,this.ownerDocDetectRegex=/.ownerDocument/gm,this.domProxy=new Proxy(this.dom,{get:function(c,d){if('body'==d)return c;if('rootNode'==d)return c;var e;if(e='nodeName'==d||'nodeType'==d||'ownerDocument'==d||'parentElement'==d||'parentNode'==d?document[d]:d in c?c[d]:document[d],!(d in c)&&e instanceof Function)e=function(h){for(var j=[],k=0;k+1<arguments.length;k++)j[k]=arguments[k+1];return h.apply(this,j)}.bind(document,e);else if(e instanceof Function){var g=function(h){for(var j=[],k=0;k+1<arguments.length;k++)j[k]=arguments[k+1];return h.apply(this,j)}.bind(c,e);e='getElementsByTagName'==d?function(h,j){return'body'==j?[this]:h.apply(this,arguments)}.bind(c,g):g}return e}.bind(document),set:function set(c,d,e){var g=function(){this[d]=e}.bind(c);return g(),!0}}),this.globalContextProxy=new Proxy(this.globalContext,{get:function(c,d,e){if('document'==e)return c.domProxy;var g=e in d?d[e]:window[e];return!(e in d)&&g instanceof Function&&(g=function(h){for(var j=[],k=0;k+1<arguments.length;k++)j[k]=arguments[k+1];return h.apply(this,j)}.bind(window,g)),g}.bind(window,this)})}return _createClass(Sandbox,[{key:'execCode',value:function execCode(code){var newcontext=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.globalContext;code=code.replace(this.ownerDocDetectRegex,'.s_ownerDocument'),function(window,document,code){var globalScopeInit='';for(var x in window)globalScopeInit+='var '+x+' = window["'+x+'"];';Node.prototype.s_ownerDocument=document,eval(globalScopeInit+code)}.bind(newcontext)(this.globalContextProxy,this.domProxy,code)}},{key:'execFunction',value:function execFunction(func,args){var newcontext=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.globalContext;if(!(func instanceof Function))throw new Exception('Object passed is not a function');return function(window,document,owDocRegEx,func){var globalScopeInit='';for(var x in window)globalScopeInit+='var '+x+' = window["'+x+'"];';var func_str=func.toString();return func_str.startsWith('function')||(func_str='function '+func_str),Node.prototype.s_ownerDocument=document,func_str=func_str.replace(owDocRegEx,'.s_ownerDocument'),eval(globalScopeInit+'('+func_str+'.bind(this)).apply(this,args)')}.bind(newcontext)(this.globalContextProxy,this.domProxy,this.ownerDocDetectRegex,func,args)}},{key:'execMethod',value:function execMethod(meth,args,obj){if(!(obj[meth]instanceof Function))throw new Exception(meth+' is not a method');var func_str=obj[meth].toString();return func_str.startsWith('function')||(func_str='function '+func_str),func_str=func_str.replace(this.superDetectRegex,function(a,b,c){return'__super__.'+b+'.bind(this)'+c}),func_str=func_str.replace(this.ownerDocDetectRegex,'.s_ownerDocument'),function(window,document,func_str){var globalScopeInit='';for(var x in window)globalScopeInit+='var '+x+' = window["'+x+'"];';globalScopeInit+='var __super__ = Object.getPrototypeOf(Object.getPrototypeOf(this));';var indx=func_str.indexOf('{')+1;return Node.prototype.s_ownerDocument=document,eval('('+[func_str.slice(0,indx),globalScopeInit,func_str.slice(indx)].join('')+').apply(this,args)')}.bind(obj)(this.globalContextProxy,this.domProxy,func_str,args)}}]),Sandbox}();